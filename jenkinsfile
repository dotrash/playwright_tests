pipeline {
   agent { docker { image 'mcr.microsoft.com/playwright:focal' } }
   stages {
      stage('install dependencies') {
         steps {
            sh 'npm install'
         }
      }
      stage('run tests') {
        steps {
            sh 'npx playwright test --reporter=line,allure-playwright'
        }
      }
      stage('generate allure report') {
        steps {
            sh 'npx allure generate ./allure-results --clean'
        }
      }
      stage('open allure report') {
        steps {
            sh 'npx allure open ./allure-report'
        }
      }
   }
}